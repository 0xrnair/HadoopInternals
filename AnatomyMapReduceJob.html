<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    Anatomy of a MapReduce Job &middot;  Hadoop Internals
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="public/css/hyde.css">
  <link rel="stylesheet" href="public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="shortcut icon" href="public/favicon.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="atom.xml">

  <!-- CSS menu -->
  <link href="public/menu_source/styles.css" rel="stylesheet" type="text/css">
  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script type='text/javascript' src='public/menu_source/menu_jquery.js'></script>
  
</head>


  <body>

    <header class="masthead">
      <div class="masthead-inner">
        <div class="center"><h1>Hadoop Internals</h1></div>
        <div id='cssmenu'>
            <ul>
               <li class='active'><a href='./'><span>Home</span></a></li>
               <li><a href='HadoopArchitectureOverview.html'><span>Architecture Overview</span></a></li>
               <li><a href='AnatomyMapReduceJob.html'><span>Anatomy of a MapReduce Job</span></a></li>
               <li class='has-sub'><a href='#'><span>Actors</span></a>
                  <ul>
                     <li><a href='JobSubmitter.html'><span>Job Submitter</span></a></li>
                     <li><a href='NodeManager.html'><span>Node Manager</span></a></li>
                     <li><a href='ResourceManager.html'><span>Resource Manager</span></a></li>
                     <li class='last'><a href='ApplicationMaster.html'><span>Application Master</span></a></li>
                  </ul>
               </li>
               <li class='has-sub'><a href='#'><span>Tasks</span></a>
                  <ul>
                     <li><a href='MapTask.html'><span>Map Task</span></a></li>
                     <li><a href='ReduceTask.html'><span>Reduce Task</span></a></li>
                     <li class='last'><a href='MapReduceMerge.html'><span>Merger</span></a></li>
                  </ul>
               </li>
               <li class='has-sub'><a href='#'><span>Model of Computation</span></a>
                  <ul>
                     <li><a href='Job.html'><span>Job</span></a></li>
                     <li><a href='Task.html'><span>Task</span></a></li>
                     <li><a href='TaskAttempt.html'><span>Task Attempt</span></a></li>
                     <li><a href='Container.html'><span>Container</span></a></li>
                     <li class='last'><a href='Application.html'><span>Application</span></a></li>
                  </ul>
               </li>
               <li class='has-sub'><a href='#'><span>Extra</span></a>
                  <ul>
                     <li><a href='AsyncDispatcher.html'><span>Async Dispatcher</span></a></li>
                     <li><a href='LocalizedResource.html'><span>Localized Resource</span></a></li>
                     <li><a href='ContainerAllocator.html'><span>Container Allocator [AM]</span></a></li>
                     <li><a href='ContainerLauncher.html'><span>Container Launcher [AM]</span></a></li>
                     <li class='last'><a href='ContainersLauncher.html'><span>Containers Launcher [NM]</span></a></li>
                  </ul>
               </li>
               <li class='last'><a href='HadoopConfigurationParameters.html'><span>Configuration Parameters</span></a></li>
            </ul>
        </div>

        <div class="colophon">
          <ul class="colophon-links">
            
            <li>
              <a href="https://sites.google.com/a/di.uniroma1.it/coppa/">Emilio Coppa</a>
            </li>
            <li>ercoppa [at] gmail [dot] com</li>
            <li>
              <a href="https://github.com/ercoppa/HadoopDiagrams">GitHub project</a>
            </li>
          </ul>
          <br />
          <div class="center"><iframe src="http://ghbtns.com/github-btn.html?user=ercoppa&repo=hadoopinternals&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="152px" height="30px"></iframe></div>
        </div>

      </div>
    </header>

    <a href="https://github.com/ercoppa/HadoopInternals/"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>

    <div class="content container">
      <div class="post">
  <h1 class="title">Anatomy of a MapReduce Job</h1>
  <br />
  <p>In MapReduce, a YARN application is called a <strong>Job</strong>. The implementation of the Application Master provided by the MapReduce framework is called <strong><code>MRAppMaster</code></strong>.</p>

<h3><a href="#timeline-of-a-mapreduce-job" id="timeline-of-a-mapreduce-job">Timeline of a MapReduce Job</a></h3>

<p><img src="public/images/timeline-mapreduce-job_534c0041-2498-44cd-9480-18910a008c0f.png" alt="Timeline MapReduce Job" />
This is the timeline of a MapReduce Job execution:</p>

<ul>
<li><strong>Map Phase</strong>: several <strong>Map Tasks</strong> are executed</li>
<li><strong>Reduce Phase</strong>: several <strong>Reduce Tasks</strong> are executed</li>
</ul>


<p>Notice that the Reduce Phase may start before the end of Map Phase. Hence, an interleaving between them is possible.</p>

<h3><a href="#map-phase" id="map-phase">Map Phase</a></h3>

<p>We now focus our discussion on the Map Phase. A key decision is how many MapTasks the Application Master needs to start for the current job.</p>

<h4><a href="#what-does-the-user-give-us" id="what-does-the-user-give-us">What does the user give us?</a></h4>

<p>Let&rsquo;s take a step back. When a client submits an application, several kinds of information are provided to the YARN infrastucture. In particular:</p>

<ul>
<li>a configuration: this may be partial (some parameters are not specified by the user) and in this case the default values are used for running the job. Notice that these default values may be the ones chosen by a Hadoop provider like Amanzon.</li>
<li>a JAR containing:

<ul>
<li>a <code>map()</code> implementation</li>
<li>a combiner implementation</li>
<li>a <code>reduce()</code> implementation</li>
</ul>
</li>
<li>input and output information:

<ul>
<li>input directory: is the input directory on HDFS? On S3? <strong>How many files?</strong></li>
<li>output directory: where do we will store the output? On HDFS? On S3?</li>
</ul>
</li>
</ul>


<p>The number of files inside the input directory is used for deciding the number of Map Tasks of a job.</p>

<h4><a href="#how-many-map-tasks" id="how-many-map-tasks">How many Map Tasks?</a></h4>

<p>The Application Master will launch one MapTask for each map split. Typically, there is a map split for each input file. If the input file is too big (bigger than the HDFS block size) then we have two or more map splits associated to the same input file. This is the pseudocode used inside the method <code>getSplits()</code> of the <code>FileInputFormat</code> class:</p>

<pre><code>num_splits = 0
for each input file f:
   remaining = f.length
   while remaining / split_size &gt; split_slope:
      num_splits += 1
      remaining -= split_size
</code></pre>

<p>where:</p>

<pre><code>split_slope = 1.1
split_size =~ dfs.blocksize
</code></pre>

<p>Notice that the configuration parameter <code>mapreduce.job.maps</code> is ignored in MRv2 (in the past it was just an hint).</p>

<h4><a href="#maptask-launch" id="maptask-launch">MapTask Launch</a></h4>

<p>[&hellip;]</p>

<h3><a href="#reduce-phase" id="reduce-phase">Reduce Phase</a></h3>

<p>[&hellip;]</p>

<h3><a href="#yarn-and-mapreduce-interaction" id="yarn-and-mapreduce-interaction">YARN and MapReduce interaction</a></h3>

<p><img src="public/images/yarn-and-mapreduce-interaction_53302af2-7d38-412b-8275-6ffe0a009433.png" alt="YARN and MapReduce interaction" /></p>

</div>

    </div>
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-49049378-1', 'ercoppa.github.io');
      ga('send', 'pageview');

    </script>

  </body>
</html>
